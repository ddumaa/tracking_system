<!DOCTYPE html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
    <title layout:fragment="title">Уведомления администратора</title>
</head>

<div layout:fragment="header"
     th:replace="~{partials/header-admin :: header}">
</div>

<div layout:fragment="afterHeader">
    <div th:replace="~{partials/breadcrumbs :: breadcrumbs(items=${breadcrumbs})}"></div>
</div>

<main layout:fragment="content">
    <div class="container mt-4">
        <h1 class="mb-3">Уведомления администратора</h1>

        <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

        <a th:href="@{/admin/notifications/new}" class="btn btn-primary mb-3">Создать уведомление</a>

        <div th:if="${notifications.isEmpty()}">
            <div class="alert alert-info">Пока нет созданных уведомлений.</div>
        </div>

        <div th:if="${!notifications.isEmpty()}">
            <table class="table table-striped table-bordered">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Заголовок</th>
                    <th>Статус</th>
                    <th>Обновлено</th>
                    <th>Показ снова</th>
                    <th>Действия</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="notification : ${notifications}"
                    th:classappend="${notification.status} == ${activeStatus} ? 'table-success' : ''">
                    <td th:text="${notification.id}"></td>
                    <td>
                        <span th:text="${notification.title}"></span>
                        <div class="small text-muted" th:if="${notification.status} == ${activeStatus}">Активное</div>
                    </td>
                    <td th:text="${notification.status == activeStatus ? 'Активно' : 'Не активно'}"></td>
                    <td th:text="${#temporals.format(notification.updatedAt, 'dd.MM.yyyy HH:mm')}"></td>
                    <td th:text="${notification.resetRequested ? 'Запрошено' : 'Отключено'}"></td>
                    <td>
                        <a th:href="@{/admin/notifications/{id}/edit(id=${notification.id})}"
                           class="btn btn-sm btn-secondary mb-1">Изменить</a>
                        <form th:action="@{/admin/notifications/{id}/activate(id=${notification.id})}"
                              method="post" class="d-inline"
                              th:if="${notification.status} != ${activeStatus}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" th:if="${_csrf != null}">
                            <button type="submit" class="btn btn-sm btn-success mb-1">Активировать</button>
                        </form>
                        <form th:action="@{/admin/notifications/{id}/deactivate(id=${notification.id})}"
                              method="post" class="d-inline"
                              th:if="${notification.status} == ${activeStatus}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" th:if="${_csrf != null}">
                            <button type="submit" class="btn btn-sm btn-warning mb-1">Деактивировать</button>
                        </form>
                        <div class="d-inline" th:if="${notification.resetRequested}">
                            <button type="button" class="btn btn-sm btn-outline-secondary mb-1" disabled>
                                Показ запрошен
                            </button>
                        </div>
                        <form th:action="@{/admin/notifications/{id}/reset(id=${notification.id})}"
                              method="post" class="d-inline"
                              th:if="${!notification.resetRequested}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" th:if="${_csrf != null}">
                            <button type="submit" class="btn btn-sm btn-info mb-1">Показать снова</button>
                        </form>
                        <form th:action="@{/admin/notifications/{id}/delete(id=${notification.id})}"
                              method="post" class="d-inline"
                              onsubmit="return confirm('Удалить уведомление?');">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" th:if="${_csrf != null}">
                            <button type="submit" class="btn btn-sm btn-danger mb-1">Удалить</button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</main>

</html>
